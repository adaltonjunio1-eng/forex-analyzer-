name: ğŸš€ Deploy Forex Analyzer PWA

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      
    - name: ğŸ“¦ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ğŸ”§ Install Dependencies
      run: |
        npm ci
        
    - name: ğŸ¨ Generate PWA Icons
      run: |
        node generate-icons.js
        
    - name: âœ… Validate PWA
      run: |
        echo "ğŸ” Validating PWA files..."
        test -f manifest.json && echo "âœ… Manifest found"
        test -f sw.js && echo "âœ… Service Worker found"
        test -f index.html && echo "âœ… Index found"
        echo "ğŸ‰ PWA validation complete!"
        
    - name: ğŸŒ Deploy to GitHub Pages
      if: github.ref == 'refs/heads/main'
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./
        enable_jekyll: false
        force_orphan: true
        user_name: 'github-actions[bot]'
        user_email: 'github-actions[bot]@users.noreply.github.com'
        commit_message: |
          ğŸš€ Deploy Forex Analyzer PWA
          
          Auto-deployed from commit: ${{ github.sha }}
          
    - name: ğŸ“Š PWA Performance Check
      if: github.ref == 'refs/heads/main'
      run: |
        echo "ğŸƒâ€â™‚ï¸ PWA Performance Tips:"
        echo "â€¢ Service Worker: âœ… Implemented"
        echo "â€¢ Offline Support: âœ… Enabled" 
        echo "â€¢ Mobile Optimized: âœ… Responsive"
        echo "â€¢ Icons Generated: âœ… Multiple sizes"
        echo "â€¢ HTTPS Required: âš ï¸  GitHub Pages provides HTTPS"
        echo ""
        echo "ğŸ“± Your PWA will be available at:"
        echo "https://${{ github.repository_owner }}.github.io/forex-analyzer/"
        echo ""
        echo "ğŸ¯ To test PWA features:"
        echo "1. Open in Chrome/Edge"
        echo "2. Look for install button"
        echo "3. Test offline functionality"
        echo "4. Try 'Add to Home Screen' on mobile"